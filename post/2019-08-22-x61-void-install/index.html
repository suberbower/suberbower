<!DOCTYPE html>
<html lang="en">
  <head>
    
      <title>Void Linux on ThinkPad X61 :: Suberblog — My notes and projects</title>
    
    <meta http-equiv="content-type" content="text/html; charset=utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
<meta name="description" content="This machine in 12&amp;rdquo; 4:3 aspect ratio is great to have on the side, literally. The TN-panel looks awful in picture but is actually good enough to work in terminal environments. The classis 7-row keyboard gives this machine it&amp;rsquo;s right to exist eternally. I&amp;rsquo;ve decided to install Void Linux, the musl edition. Here are my notes to guide trough the setup process on the ThinkPad X61!
 musl is a new standard library to power a new generation of Linux-based devices."/>
<meta name="keywords" content="tech, linux, thinkpad, security, hack, configuration, development, programming, notes, projects, guides"/>
<meta name="robots" content="noodp"/>
<link rel="canonical" href="/post/2019-08-22-x61-void-install/" />





<link rel="stylesheet" href="/assets/style.css">


<link rel="stylesheet" href="/style.css">


<link rel="apple-touch-icon-precomposed" sizes="144x144" href="/img/apple-touch-icon-144-precomposed.png">
<link rel="shortcut icon" href="/img/favicon.png">


<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Void Linux on ThinkPad X61"/>
<meta name="twitter:description" content="This machine in 12&#34; 4:3 aspect ratio is great to have on the side, literally. The TN-panel looks awful in picture but is actually good enough to work in terminal environments. The classis 7-row keyboard gives this machine it&#39;s right to exist eternally. I&#39;ve decided to install Void Linux, the musl edition. Here are my notes to guide trough the setup process on the ThinkPad X61!"/>



<meta property="og:title" content="Void Linux on ThinkPad X61" />
<meta property="og:description" content="This machine in 12&#34; 4:3 aspect ratio is great to have on the side, literally. The TN-panel looks awful in picture but is actually good enough to work in terminal environments. The classis 7-row keyboard gives this machine it&#39;s right to exist eternally. I&#39;ve decided to install Void Linux, the musl edition. Here are my notes to guide trough the setup process on the ThinkPad X61!" />
<meta property="og:type" content="article" />
<meta property="og:url" content="/post/2019-08-22-x61-void-install/" />
<meta property="article:published_time" content="2019-08-22T00:00:00+00:00" />
<meta property="article:modified_time" content="2019-08-22T00:00:00+00:00" /><meta property="og:site_name" content="Suberblog" />






  </head>
  <body class="">
    <div class="container">
      <header class="header">
  <span class="header__inner">
    <a href="/" class="logo" style="text-decoration: none;">
  
    <span class="logo__mark"><svg xmlns="http://www.w3.org/2000/svg" class="greater-icon" viewBox="0 0 44 44">
  <path fill="none" d="M15 8l14.729 14.382L15 35.367"/>
</svg>
</span>
    <span class="logo__text">Suberblog</span>
    <span class="logo__cursor"></span>
  
</a>

    <span class="header__right">
      
        <nav class="menu">
  <ul class="menu__inner menu__inner--desktop">
    
      
        
          <li><a href="/about">About</a></li>
        
      
        
          <li><a href="/blog">Blog</a></li>
        
      
      
    
  </ul>

  <ul class="menu__inner menu__inner--mobile">
    
      
        <li><a href="/about">About</a></li>
      
    
      
        <li><a href="/blog">Blog</a></li>
      
    
  </ul>
</nav>

        <span class="menu-trigger">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M0 0h24v24H0z" fill="none"/>
            <path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/>
          </svg>
        </span>
      
      <span class="theme-toggle">
        <svg class="theme-toggler" width="24" height="24" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
  <path d="M22 41C32.4934 41 41 32.4934 41 22C41 11.5066 32.4934 3 22
  3C11.5066 3 3 11.5066 3 22C3 32.4934 11.5066 41 22 41ZM7 22C7
  13.7157 13.7157 7 22 7V37C13.7157 37 7 30.2843 7 22Z"/>
</svg>

      </span>
    </span>
  </span>
</header>


      <div class="content">
        
  <div class="post">
    <h2 class="post-title"><a href="/post/2019-08-22-x61-void-install/">Void Linux on ThinkPad X61</a></h2>
    <div class="post-meta">
      
        <span class="post-date">
            22-08-2019
        </span>
      
      <span class="post-author">— Written by Suberbower</span>
      
    </div>

    
      <span class="post-tags">
        
          #<a href="/tags/thinkpad/">ThinkPad</a>&nbsp;
        
          #<a href="/tags/linux/">Linux</a>&nbsp;
        
          #<a href="/tags/notes/">notes</a>&nbsp;
        
      </span>
    

    
      
        <img src="/img/x61-2.png" class="post-cover" />
      
    

    <div class="post-content">
      

<p>This machine in 12&rdquo; 4:3 aspect ratio is great to have on the side, literally. The TN-panel looks awful in picture but is actually good enough to work in terminal environments. The classis 7-row keyboard gives this machine it&rsquo;s right to exist eternally. I&rsquo;ve decided to install <a href="https://voidlinux.org/">Void Linux</a>, the <a href="https://www.musl-libc.org/faq.html">musl</a> edition. Here are my notes to guide trough the setup process on the ThinkPad X61!</p>

<blockquote>
<p>musl is a new standard library to power a new generation of Linux-based devices. It is lightweight, fast, simple, free, and strives to be correct in the sense of standards-conformance and safety.</p>

<p><strong>voidlinux.org</strong></p>
</blockquote>

<h3 id="download-installation-media">Download installation media</h3>

<p>First download the <code>void-live-x86_64-musl-20181111.iso</code>, <a href="https://alpha.de.repo.voidlinux.org/live/current/">current</a> release, <code>sha256sums.txt</code>, <code>sha256sums.txt.sig</code> and verify the image:</p>

<pre><code>$ wget https://alpha.de.repo.voidlinux.org/live/current/void-live-x86_64-musl-20181111.iso
</code></pre>

<pre><code>$ wget http://alpha.de.repo.voidlinux.org/live/current/sha256sums.txt{,.sig}
</code></pre>

<h3 id="verify-image-integrity">Verify image integrity</h3>

<p>Verify the integrity of these files using <a href="https://www.gnu.org/software/coreutils/manual/html_node/sha1sum-invocation.html#sha1sum-invocation">sha256sum</a>:</p>

<pre><code>$ sha256sum -c --ignore-missing sha256sums.txt void-live-x86_64-musl-20181111.iso
void-live-x86_64-musl-20181111.iso: OK
</code></pre>

<p>The integrity check should return OK, which means we can proceed using this .iso Image file. In all other cases, the file can be corrupt or has been modified. Don&rsquo;t use it, change to tier 1 <a href="https://docs.voidlinux.org/maintenance/repositories/mirrors/list.html">mirrors</a> and re-download instead.</p>

<h3 id="verify-image-authenticity">Verify image authenticity</h3>

<p>The <code>sha256sums.txt</code> file is published and digitally signed by the Void Linux maintainers with the Void Images key:</p>

<ul>
<li>Signer: Void Linux Image Signing Key <a href="mailto:images@voidlinux.eu">images@voidlinux.eu</a></li>
<li>KeyID: <code>B48282A4</code></li>
<li>Fingerprint: <code>CF24 B9C0 3809 7D8A 4495 8E2C 8DEB DA68 B482 82A4</code></li>
</ul>

<p>To download this key:</p>

<pre><code>$ gpg --recv-keys B48282A4
gpg: requesting key B48282A4 from hkp server keys.gnupg.net
gpg: key B48282A4: public key &quot;Void Linux Image Signing Key &lt;images@voidlinux.eu&gt;&quot; imported
gpg: no ultimately trusted keys found
gpg: Total number processed: 1
gpg:               imported: 1  (RSA: 1)
</code></pre>

<p>Use this key to verify the signature of sha256sums.txt in sha256sums.txt.sig:</p>

<pre><code>$ gpg --verify sha256sums.txt.sig
gpg: assuming signed data in 'sha256sums.txt'
gpg: Signature made Sun 18 Nov 2018 11:39:33 PM CET
gpg:                using RSA key CF24B9C038097D8A44958E2C8DEBDA68B48282A4
gpg: Good signature from &quot;Void Linux Image Signing Key &lt;images@voidlinux.eu&gt;&quot; [expired]
gpg: Note: This key has expired!
Primary key fingerprint: CF24 B9C0 3809 7D8A 4495  8E2C 8DEB DA68 B482 82A4
</code></pre>

<p>The signature for the checksums is authentic. The hash is valid for the Void Image file. We can proceed to create the installation media. This could either be a USB drive or SD card.</p>

<h3 id="prepare-installation-media">Prepare installation media</h3>

<p>Write the image file to bootable media. First identify the device you&rsquo;ll write to using <a href="https://www.gnu.org/software/fdisk/#introduction">fdisk</a>. Make sure it&rsquo;s plugged in already.</p>

<pre><code># fdisk -l
Disk /dev/sdb: 28.99 GiB, 31104958464 bytes, 60751872 sectors
Disk model: Ultra Fit       
Units: sectors of 1 * 512 = 512 bytes
Sector size (logical/physical): 512 bytes / 512 bytes
I/O size (minimum/optimal): 512 bytes / 512 bytes
</code></pre>

<p>The output shows my USB-flashdrive as <code>/dev/sdb</code>. In linux, the path to the device will typically be in this form: <code>/dev/sdX</code> for USB, <code>/dev/mmcblkX</code> for SD cards.</p>

<p>Ensure the correct state by using this command: <a href="https://www.gnu.org/software/libc/manual/html_node/Mount_002dUnmount_002dRemount.html">umount</a>.</p>

<pre><code># umount /dev/sdb
umount: /dev/sdb: not mounted.
</code></pre>

<h3 id="write-image-file-to-usb-flashdrive">Write image-file to USB-flashdrive</h3>

<p>Write the image file to USB drive using <a href="https://www.gnu.org/software/coreutils/manual/html_node/dd-invocation.html#dd-invocation">dd</a>:</p>

<pre><code># dd bs=4M if=~/void-live-x86_64-musl-20181111.iso of=/dev/sdb
86+1 records in
86+1 records out
361758720 bytes (362 MB, 345 MiB) copied, 9.07791 s, 39.9 MB/s
</code></pre>

<p>Finally, flush all data with <code>sync</code>, unplug the installation media and give it a kiss:</p>

<pre><code>$ sync
</code></pre>

<h3 id="boot-installation-media">Boot installation media</h3>

<p>Plug in the USB-flashdrive when the X61 is <code>off</code> and turn it <code>on</code>. Hold <code>F12</code> to open &ldquo;boot menu&rdquo; and select <code>-USB HDD</code>.
Grub will show up. Select <code>Void Linux 4.18.17_1 x86_64-musl (RAM)</code> to load the entire image to RAM. Loading like so will take a bit more time but speed up the rest of the installation process.</p>

<p>We&rsquo;ll be greeted by the void-live login prompt. Login with <code>root</code> using password <code>voidlinux</code>:</p>

<pre><code>void-live login: root
Password:
Last login: Tue Aug 22 06:35:54 on tty1
# _
</code></pre>

<p>There is a GUI installer available and can be run with <code>void-installer</code>, but we&rsquo;ll skip this for the sake of learning. Gain more understanding and proceed with manual isntallation.</p>

<h3 id="setup-network-connection">Setup network connection</h3>

<p>The easiest way is to plug in the good old <a href="https://en.wikipedia.org/wiki/Modular_connector#8P8C">RJ45</a>-cable. The <code>dhcpcd</code> service is enabled by default. If using this, skip the configuration for wifi. We should be online by now, check connection with <a href="https://linux.die.net/man/8/ping">ping</a> (use <code>ctrl</code>+<code>c</code> to exit)</p>

<pre><code>$ ping voidlinux.org
PING voidlinux.org (185.199.109.153) 56(84) bytes of data.
64 bytes from 185.199.109.153 (185.199.109.153): icmp_seq=1 ttl=57 time=14.1 ms
64 bytes from 185.199.109.153 (185.199.109.153): icmp_seq=2 ttl=57 time=15.3 ms
64 bytes from 185.199.109.153 (185.199.109.153): icmp_seq=3 ttl=57 time=17.3 ms
</code></pre>

<p>If neccesary, enable <code>dhcpcd</code> service manually using:</p>

<pre><code># ln -s /etc/sv/dhcpcd /var/service/
# _
</code></pre>

<p>Now the service has been activated with no response. According to the <a href="https://homepage.cs.uri.edu/~thenry/resources/unix_art/ch01s06.html">UNIX philosphy</a>: &ldquo;No news is good news&rdquo;. Challenge this by verifying the current state:</p>

<pre><code># sv status dhcpcd
run: dhcpcd: (pid 916) 12s
</code></pre>

<h3 id="wifi-configuration">Wifi configuration</h3>

<p>Wireless connections are handled by the <a href="https://github.com/void-linux/void-packages/tree/master/srcpkgs/wpa_supplicant">wpa_supplicant</a> package; it can at least handle <a href="https://en.wikipedia.org/wiki/Wired_Equivalent_Privacy">WEP</a>, <a href="https://en.wikipedia.org/wiki/Wi-Fi_Protected_Access">WPA-PSK</a> (Personal) and <a href="https://en.wikipedia.org/wiki/Wi-Fi_Protected_Access">WPA-EAP</a> (Enterprise).</p>

<p>Modify <code>wpa_supplicant.conf</code> to match your network device:</p>

<pre><code># wpa_passphrase 'My SSID' &gt;&gt; /etc/wpa_supplicant/wpa_supplicant.conf
my_wifi_password&lt;enter&gt;
# sv restart dhcpcd
ok: run: dhcpcd: (pid 916) 0s
</code></pre>

<p>Give it approximately 12 seconds to connect, verify IP address and ping to ensure the internet connection is working. (wifi <code>interface_name</code> should start with <code>wls</code>)</p>

<pre><code># ip addr
1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt;...
2: enp0: &lt;NO-CARRIER,BORADCAST,MULTICAST,UP&gt;...
3: wls3: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UP mode DORMANT group default qlen 1000
    link/ether 00:00:00:00:00:00 brd ff:ff:ff:ff:ff:ff
    inet 123.123.213.123/24 brd 123.123.123.255 scope global noprefixroute wls3
       valid_lft forever preferred_lft forever
    inet6 1234::1234:1234:1234:1234/64 scope link
       valid_lft forever preferred_lft forever
# ping voidlinux.org
PING voidlinux.org (185.199.109.153) 56(84) bytes of data...
</code></pre>

<h3 id="the-filesystem">The filesystem</h3>

<p>The BIOS shipped with is only supporting <a href="https://wiki.archlinux.org/index.php/GRUB#GUID_Partition_Table_(GPT)_specific_instructions">legacy boot</a>. Due a <a href="https://docs.voidlinux.org/installation/live-images/partitions.html">DOS partition table</a> only supports 4 primary partitions, I prefer to go for a <a href="https://docs.voidlinux.org/installation/live-images/partitions.html">GUID partition table</a>. Creating a small <a href="https://docs.voidlinux.org/installation/live-images/partitions.html">MBR</a> partition upfront will do the trick.</p>

<h3 id="swap-space">Swap space</h3>

<p>A <a href="https://www.kernel.org/doc/gorman/html/understand/understand014.html">swap</a> partition is not required but recommended for systems with low RAM. Since I have 2 GB RAM and plan to use hibernation, i&rsquo;ll create a swap space 3x the RAM, a total of 6 GB. Set your swap space according to your preference.</p>

<h3 id="boot-partition">Boot partition</h3>

<p>A seperate <code>/boot</code> partition isn&rsquo;t required but I choose to use a <code>/boot</code> partition to manage kernels manually. Each kernel image will take around 18 MB. I&rsquo;ll create a subersized <code>/boot</code> partition so I don&rsquo;t have to worry about space. 1 GB it will be. If you don&rsquo;t plan to customize the Linux kernel, 200 MB should be sufficient (room for 3 kernels).</p>

<h3 id="root-partition">Root partition</h3>

<p>The last but not least is the root <code>/</code> partition. Void Linux will be installed here and it&rsquo;s recommended to seperate your <code>/home</code> folder into another partition. This is for convenience when reistalling the system. Since i don&rsquo;t prefer this method of recovery I will not seperate my <code>/home</code> folder. Again, your preference may vary.</p>

<h3 id="hard-drive-encryption">Hard drive encryption</h3>

<p>A large part will be encrypted. I left the boot partition open because i might change the bootloader later on. Swap and root will be encrypted as one, so create one partition and split them up after.</p>

<h3 id="create-the-filesystem">Create the filesystem</h3>

<p>First set the hard drive into parts, than encrypt the relevant partitions and filesystem.</p>

<p>Consider to erase ALL data first to start clean. The point of doing so is to make any previous data unrecoverable, so it&rsquo;s unlikely you&rsquo;ll be able to recover any date in case you&rsquo;ve wiped the wrong disk.</p>

<blockquote>
<p>Get some toothpicks to stabilize your eyelids and please pay attention.</p>

<p><strong>suberbower</strong></p>
</blockquote>

<h3 id="wipe-the-correct-disk">Wipe the correct disk</h3>

<p>To see all available disks, use <code>lsblk</code>. The disk named <code>sda</code> is the target disk in my case. There is no way back after the <code>enter</code> button has been pressed.</p>

<pre><code># lsblk
NAME      WAJ:MIN RM   SIZE RO TYPE MOUNTPOINT
loop0         7:0  0 257.1M  1 loop
loop1         7:1  0   618M  1 loop 
|-live-rw   254:0  0   618M  0 dm   /
|-live-base 254:1  0   618M  1 dm
loop2         7:2  0    32G  0 loop
|-live-rw   254:0  0   618M  0 dm   /
sda           8:0  0 149.1G  0 disk
sdb          8:16  1    29G  0 disk
|-sdb1       8:17  1   345M  0 part /run/initramfs/live
|-sdb2       8:18  1    32M  0 part
# dd if=/dev/urandom of=/dev/sda
_
</code></pre>

<p>This process takes hours, depending on the size of your disk. It&rsquo;s time to do some <a href="https://www.youtube.com/watch?v=3_Q-yYfjeBM">Yoga</a>. You may thank me later :P</p>

<h3 id="create-partitions">Create partitions</h3>

<p>If you&rsquo;ve had a Yoga session, you should be as fresh as your disk by now. Let&rsquo;s seperate the disk into parts. I&rsquo;ve planned to use three partitions:</p>

<ul>
<li><code>/boot</code></li>
<li><code>swap</code><br /></li>
<li><code>/</code></li>
</ul>

<p>Due to <code>swap</code> and <code>/</code> will encrypted as one partition, create one for both and split them up afterwards.</p>

<pre><code># cfdisk -z /dev/sda
</code></pre>

<p>You&rsquo;ll be prompted to select a label type, select <code>gpt</code>. To be able to actually boot this system we need a small MBR partition.
Create the MBR partition by selecting <code>New</code>, define <code>Partition size</code>: <code>1M</code> and change the type to <code>BIOS boot</code>.</p>

<p>Select <code>New</code> for the second partition, define <code>Partition size</code>: <code>1G</code> and  change the type to <code>EFI System</code>.</p>

<p>Create the third partition for <code>swap</code> and <code>/</code> combined. We will seperate them in <code>logical volume</code> after the partition has been encrypted. Since I plan <code>6G</code> <code>Swap space</code> and <code>55G</code> for <code>/</code>, I select <code>New</code>, <code>Partition size</code>: <code>61G</code>, <code>Type</code> <code>Linux filesystem</code>.</p>

<p>The third partition is basically the space appointed to use in Linux. You can decide to use up remaining space or leave <code>Free space</code> for later, for example <a href="https://en.wikipedia.org/wiki/Multi-booting">dual-boot</a>.</p>

<p>Double check your table and to wriite it to disk, select <code>Write</code>.</p>

<pre><code>Are you sure you want to write the partition table to disk? _
</code></pre>

<p>type <code>yes</code> and hit <code>enter</code> with confidence. Select <code>Quit</code> to exit.</p>

<p>Use <code>lsblk</code> and notice the two parts that have been created:</p>

<pre><code>sda          8:0   0 149.1G  0 disk
|-sda1       8:1   1     1M  0 part 
|-sda2       8:2   1     1G  0 part
|-sda3       8:3   1    61G  0 part
sdb          8:16  1    29G  0 disk
|-sdb1       8:17  1   345M  0 part /run/initramfs/live
|-sdb2       8:18  1    32M  0 part
</code></pre>

<p>Setup filesystem for <code>/dev/sda2</code>, use <code>ext2</code>and label it as <code>boot</code>:</p>

<pre><code># mkfs.ext2 -L boot /dev/sda2
</code></pre>

<h3 id="encrypt-the-desired-partition">Encrypt the desired partition</h3>

<p>Setup encryption with <a href="https://en.wikipedia.org/wiki/Linux_Unified_Key_Setup">LUKS</a> and create the system volumes within.</p>

<pre><code># cryptsetup luksFormat /dev/sda3
WARNING!
========
This will overwrite data on /dev/sda3 irrevocably.
Are you sure? (Type uppercase yes) YES
Enter passphrase for /dev/sda2:
Verify passphrase:
</code></pre>

<p>Decrypt sda3 and name the drive to void, voidlinux or <a href="https://www.youtube.com/watch?v=_lajJq20kmc">hunnybunny</a>.</p>

<pre><code># cryptsetup luksOpen /dev/sda3 hunnybunny
Enter passphrase for /dev/sda3:
</code></pre>

<p>Create a <code>volume group</code> within.</p>

<pre><code># vgcreate voidlinux /dev/mapper/hunnybunny
Physical volume &quot;/dev/mapper/hunnybunny&quot; succesfully created.
Volume group &quot;voidlinux&quot; successfully created.
</code></pre>

<p>Create a <code>logical volume</code> for <code>swap</code> and another for <code>/</code></p>

<pre><code># lvcreate --name swap -L 6GB voidlinux
Logical volume &quot;swap&quot; created.
# lvcreate --name root -l 100%free voidlinux
Logical volume &quot;root&quot; created.
</code></pre>

<p>Give <code>/</code> a filesystem, i chose btrfs:</p>

<pre><code># mkfs.btrfs -L root /dev/voidlnux/root
...
Devices:
   ID     SIZE PATH
    1 55.00GiB /dev/voidlinux/root
</code></pre>

<h3 id="mount-the-filesystem-to-prepare-for-chroot">Mount the filesystem to prepare for chroot</h3>

<p>Almost ready for installation. We need to mount the partitions so they become accessable.</p>

<pre><code># mount /dev/voidlinux/root /mnt
# mkdir /mnt/boot
# mount /dev/sda1 /mnt/boot
# mkswap /dev/voidlinux/swap
Setting up swapspace version 1, size = 6 GiB (6442446848 bytes)
no label. UUID=hunny-bunny-swap-hunny-bunny-swap
</code></pre>

<h3 id="double-check-mountpoints">Double check mountpoints</h3>

<p>Make sure you work with correct mountpoints. In my case the output of <code>lsblk</code> should be:</p>

<pre><code>sda                      8:0   0 149.1G  0 disk
|-sda1                   8:1   0     1M  0 part  [MBR] 
|-sda2                   8:2   0     1G  0 part  /mnt/boot 
|-sda3                   8:3   0    61G  0 part 
   |-hunnybunny        254:2   0    61G  0 crypt
      |-voidlinux-swap 254:3   0     6G  0 lvm   [SWAP]
      |-voidlinux-root 254:4   0    55G  0 lvm   /mnt
sdb                      8:16  1    29G  0 disk
|-sdb1                   8:17  1   345M  0 part  /run/initramfs/live
|-sdb2                   8:18  1    32M  0 part
</code></pre>

<h3 id="install-base-system">Install base system</h3>

<p>Instruct xbps to work with the correct folders.</p>

<pre><code># for dir in dev proc sys; do 
&gt;mkdir /mnt/$dir
&gt;mount --rbind /$dir /mnt/$dir
&gt;done
_
</code></pre>

<p>It&rsquo;s time to install the <code>base system</code> and the very neccesary packages: <code>cryptsetup</code>,<code>lvm2</code>, <code>grub</code>. Feel free to add other packages for installation. I&rsquo;ve added <a href="https://www.vim.org/docs.php">vim</a>. Go for one of the two options.</p>

<p>Option 1: To install with current packages:</p>

<pre><code># xbps-install -Sy -R https://alpha.de.repo.voidlinux.org/current -r /mnt base-system lvm2 cryptsetup grub vim
</code></pre>

<p>Option 2: To install with Installation media packages:</p>

<pre><code># xbps-install -Sy -r /mnt base-system lvm2 cryptsetup grub vim
</code></pre>

<p>Now we can finally proceed with <code>chroot</code> <a href="https://www.urbandictionary.com/define.php?term=woot%20woot">wootwoot</a>! It means that we can change to <code>/</code> and claim ownership.</p>

<pre><code># chroot /mnt /bin/bash
# chown root:root /
# chmod 755 /
# passwd root
New password:
Retype new password:
passwd: password updated successfully
</code></pre>

<h3 id="setup-base-system">Setup base system</h3>

<p>We need to setup the base system and configure <a href="https://www.gnu.org/software/grub/manual/grub/grub.html">grub</a> to succesfully boot into system hereafter.</p>

<h3 id="hostname">Hostname</h3>

<p>Set the hostname in <code>/etc/hostname</code>. My hostname is X61.</p>

<pre><code># echo x61 &gt; /etc/hostname
</code></pre>

<h3 id="the-filesystem-table">The filesystem table</h3>

<p>We need to add our partitions to this table <code>fstab</code>. If you haven&rsquo;t installed <a href="https://www.vim.org/docs.php">vim</a> before, you can use <a href="https://en.wikipedia.org/wiki/Vi">vi</a>.</p>

<pre><code># vim /etc/fstab
</code></pre>

<p>After editing my <code>fstab</code> looks like this:</p>

<pre><code># See fstab(5).
#
# &lt;file system&gt;     &lt;dir&gt; &lt;type&gt; &lt;options&gt;             &lt;dump&gt; &lt;pass&gt;
tmpfs               /tmp  tmpfs  defaults,nosuid,nodev 0      0
/dev/sda2           /boot ext2   defaults              0      0
/dev/voidlinux/swap swap  swap   defaults              0      0
/dev/voidlinux/root /     btrfs  defaults              0      0
</code></pre>

<h3 id="find-the-universally-unique-identifier">Find the Universally Unique Identifier</h3>

<p>Use this command to find the root partition <code>/</code> <a href="https://en.wikipedia.org/wiki/Universally_unique_identifier">UUID</a> and write it to grub.</p>

<pre><code># blkid |grep /dev/sda3 &gt;&gt; /etc/default/grub
</code></pre>

<h3 id="grub">GRUB</h3>

<p>Configure GRUB bootoptions to appoint to <code>/dev/sda3</code> as target disk for boot.</p>

<pre><code># vim /etc/default/grub
</code></pre>

<p>We have written the UUID to easily append <code>rd.auto=1 cryptdevice=UUID=123a123a-123a-123a-132a123b:lvm</code> within the double quotes to this line <code>GRUB_CMDLINE_LINUX_DEFAULT=</code></p>

<p>Enable decryption at boot by adding <code>GRUB_ENABLE_CRYPTODISK=y</code>.</p>

<p>Thes two lines under <code>GRUB_DISTRIBUTOR</code> will now look like this:</p>

<pre><code>...
GRUB_DISTRIBUTOR=&quot;hunnybunny&quot;
GRUB_CMDLINE_LINUX_DEFAULT=&quot;loglevel=4 slub_debug=P page_poison=1 rd.auto=1 cryptdevice=UUID=123a123a-123a-123a-132a123b:lvm&quot;
GRUB_ENABLE_CRYPTODISK=y
...
</code></pre>

<h3 id="protected-file-key">Protected file key</h3>

<p>The ThinkPad X61 doesn&rsquo;t support UEFI by default. It&rsquo;s a pity that we cannot use a predefined key to decrypt the system volume. We need to enter the encryption password at boot. If you have custom BIOS with UEFI enabled, proceed to make the key.
Create <code>volume.key</code> and add it to <code>/etc/crypttab</code></p>

<pre><code># dd bs=512 count=4 if=/dev/urandom of=/boot/volume.key
4+0 records in
4+0 records out
2048 bytes (2.0 kB, 2.0 KiB) copied, 0.00352824 s, 580 kB/s
# cryptsetup luksAddKey /dev/sda2 /boot/volume.key
Enter any existing passphrase:
# chmod 000 /boot/volume.key
# chmod -R g-rwx,o-rwx /boot
</code></pre>

<p>Add key to <code>/etc/crypttab</code>.</p>

<pre><code>echo hunnybunny /dev/sda2/ /boot/volume.key luks &gt;&gt; /etc/crypttab
</code></pre>

<h3 id="add-to-include-in-bootprocess">Add to include in bootprocess</h3>

<p>Include the <code>volume.key</code> and <code>crypttab</code> to have it loaded toghether with kernel modules.</p>

<pre><code># cat /etc/dracut.conf.d/10-crypt.conf
install_items+=&quot; /boot/volume.key /etc/crypttab &quot;
</code></pre>

<h3 id="finalize-the-installation">Finalize the installation</h3>

<p>The boot has been setup by now. Finalize the installation by installing Grub and reconfigure
the package manager by selecting the kernel of choice.</p>

<h3 id="install-grub">Install Grub</h3>

<pre><code># grub-install /dev/sda3
Installing for i386-pc platform.
Installation finished. No error reported.
</code></pre>

<h3 id="reconfigure-package-manager">Reconfigure package manager</h3>

<pre><code># xbps-reconfigure -f linux5.2
linux5.2: configuring ...
Executing post-install kernel hook: 20-dracut ...
Executing post-install kernel hook: 50-grub ...
Generating grub configuration file ...
Found linux image: /boot/vmlinuz-5.2.17_1
Found initrd image: /boot/initramfs-5.2.17_1.img
done
linux5.2: configured successfully.
</code></pre>

<h3 id="unplug-installation-media-and-reboot">Unplug installation media and reboot!</h3>

<p>Unplug USB-flashdrive and reboot! If everything went right, the computer will restart to boot into the Void Linux. Good job!</p>

    </div>
    
      <div class="pagination">
        <div class="pagination__title">
          <span class="pagination__title-h">Read other posts</span>
          <hr />
        </div>
        <div class="pagination__buttons">
          
            <span class="button previous">
              <a href="/post/2019-08-23-x61-keyb/">
                <span class="button__icon">←</span>
                <span class="button__text">ThinkPad X61 keyboard swap</span>
              </a>
            </span>
          
          
        </div>
      </div>
    

    <div id="disqus_thread"></div>
<script type="application/javascript">
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "suberbower" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

    </div>

      </div>

      
        <footer class="footer">
  <div class="footer__inner">
    
      <a href="/" class="logo" style="text-decoration: none;">
  
    <span class="logo__mark"><svg xmlns="http://www.w3.org/2000/svg" class="greater-icon" viewBox="0 0 44 44">
  <path fill="none" d="M15 8l14.729 14.382L15 35.367"/>
</svg>
</span>
    <span class="logo__text">Suberblog</span>
    <span class="logo__cursor"></span>
  
</a>

      <div class="copyright">
        <span>Copyright © 2019 All rights reserved</span>
        <span>the "Suberblog" by <a href="https://twitter.com/suberbowercom" target="_blank"
	rel="noopener">Suberbower</a></span>
      </div>
    
  </div>
</footer>

<script src="/assets/main.js"></script>
<script src="/assets/prism.js"></script>


      
    </div>

    
  </body>
</html>
